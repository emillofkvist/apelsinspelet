<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Apelsinspel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        h1 {
            color: #e67e22;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-box {
            background: rgba(230, 126, 34, 0.05);
            border: 1px solid rgba(230, 126, 34, 0.3);
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            text-align: center;
        }

        .stat-label {
            color: rgba(0, 0, 0, 0.5);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            color: #ff9f43;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .orange-container {
            position: relative;
            width: 280px;
            height: 280px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .orange-slice {
            width: 250px;
            height: 250px;
            position: relative;
            filter: drop-shadow(0 0 30px rgba(255, 159, 67, 0.4));
            transition: filter 0.2s;
        }

        .orange-slice img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
            transition: filter 0.5s ease, transform 0.25s ease;
        }

        .orange-slice img.pop {
            transform: scale(1.4);
        }

        .orange-slice:active {
            filter: drop-shadow(0 0 50px rgba(255, 159, 67, 0.7));
        }

        .click-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(255, 159, 67, 0.8);
            animation: ripple 0.5s ease-out forwards;
            pointer-events: none;
        }

        @keyframes ripple {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2.5);
                opacity: 0;
            }
        }

        .timer-box {
            margin-bottom: 1rem;
        }

        .timer-value {
            color: #e67e22;
            font-size: 1.4rem;
            font-weight: bold;
        }

        .timer-value.urgent {
            color: #e74c3c;
        }

        .hint {
            color: rgba(0, 0, 0, 0.3);
            margin-top: 1.5rem;
            font-size: 0.9rem;
        }

        .leaderboard {
            margin-top: 1.5rem;
            width: 300px;
            max-width: 90vw;
        }

        .leaderboard h2 {
            color: #e67e22;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .leaderboard ol {
            list-style: none;
            padding: 0;
        }

        .leaderboard li {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0.8rem;
            border-bottom: 1px solid rgba(230, 126, 34, 0.15);
            font-size: 0.95rem;
            color: #333;
        }

        .leaderboard li .rank {
            color: #e67e22;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .leaderboard li .score {
            font-weight: bold;
            color: #e67e22;
        }

        .game-over {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .game-over.visible {
            display: flex;
        }

        .game-over p {
            font-size: 1.2rem;
            color: #333;
        }

        .game-over input {
            padding: 0.5rem 1rem;
            border: 2px solid #e67e22;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            text-align: center;
            width: 200px;
        }

        .game-over button, .start-btn {
            padding: 0.6rem 1.5rem;
            background: #e67e22;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
        }

        .game-over button:hover, .start-btn:hover {
            background: #d35400;
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }

            .orange-container {
                width: 240px;
                height: 240px;
            }

            .orange-slice {
                width: 200px;
                height: 200px;
            }

            .stats {
                gap: 1rem;
            }

            .stat-box {
                padding: 0.6rem 1rem;
            }

            .stat-value {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <h1>Apelsinspelet</h1>

    <div class="timer-box">
        <span class="timer-value" id="timer">2:00</span>
    </div>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-label">Klick</div>
            <div class="stat-value" id="click-count">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Varv/s</div>
            <div class="stat-value" id="rps">0.0</div>
        </div>
    </div>

    <div class="orange-container" id="orange-container">
        <div class="orange-slice" id="orange">
            <img src="https://img.freepik.com/free-photo/slice-ripe-orange-citrus-fruit-isolated-white_146671-19260.jpg" alt="Apelsinskiva" draggable="false">
        </div>
    </div>

    <p class="hint" id="hint">Tryck på apelsinen för att starta!</p>

    <div class="game-over" id="game-over">
        <p>Tiden är slut! Du fick <strong id="final-score">0</strong> klick!</p>
        <input type="text" id="player-name" placeholder="Ditt namn" maxlength="20">
        <button id="save-btn">Spara resultat</button>
        <button class="start-btn" id="restart-btn">Spela igen</button>
    </div>

    <div class="leaderboard" id="leaderboard">
        <h2>Topplista</h2>
        <ol id="leaderboard-list"></ol>
    </div>

    <script>
        const orange = document.getElementById('orange');
        const container = document.getElementById('orange-container');
        const clickCountEl = document.getElementById('click-count');
        const rpsEl = document.getElementById('rps');
        const timerEl = document.getElementById('timer');
        const hintEl = document.getElementById('hint');
        const gameOverEl = document.getElementById('game-over');
        const finalScoreEl = document.getElementById('final-score');
        const playerNameInput = document.getElementById('player-name');
        const saveBtn = document.getElementById('save-btn');
        const restartBtn = document.getElementById('restart-btn');
        const leaderboardList = document.getElementById('leaderboard-list');

        let clickCount = 0;
        let angle = 0;
        let angularVelocity = 0;
        let lastTime = performance.now();
        let gameStarted = false;
        let gameOver = false;
        let timeLeft = 120;
        let timerInterval = null;

        const CLICK_BOOST = 1.5;
        const DECAY_FACTOR = 0.999;
        const MIN_VELOCITY = 0.01;
        const GAME_DURATION = 120;

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.textContent = formatTime(timeLeft);
                if (timeLeft <= 10) timerEl.classList.add('urgent');
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function endGame() {
            clearInterval(timerInterval);
            gameOver = true;
            finalScoreEl.textContent = clickCount;
            gameOverEl.classList.add('visible');
            hintEl.style.display = 'none';
        }

        function resetGame() {
            clearInterval(timerInterval);
            clickCount = 0;
            angle = 0;
            angularVelocity = 0;
            timeLeft = GAME_DURATION;
            gameStarted = false;
            gameOver = false;
            clickCountEl.textContent = '0';
            rpsEl.textContent = '0.0';
            timerEl.textContent = formatTime(GAME_DURATION);
            timerEl.classList.remove('urgent');
            gameOverEl.classList.remove('visible');
            hintEl.style.display = '';
            hintEl.textContent = 'Tryck på apelsinen för att starta!';
            img.style.filter = '';
            orange.style.transform = '';
        }

        function update(now) {
            const dt = (now - lastTime) / 16.67;
            lastTime = now;

            angle += angularVelocity * dt;
            angularVelocity *= Math.pow(DECAY_FACTOR, dt);

            if (Math.abs(angularVelocity) < MIN_VELOCITY) {
                angularVelocity = 0;
            }

            orange.style.transform = `rotate(${angle}deg)`;

            const rps = Math.abs(angularVelocity) * 60 / 360;
            rpsEl.textContent = rps.toFixed(1);

            requestAnimationFrame(update);
        }

        const colorMilestones = [
            { at: 0,   hue: 0,   saturate: 1,   brightness: 1   },
            { at: 100, hue: 90,  saturate: 1.5, brightness: 1   },
            { at: 200, hue: 210, saturate: 1.5, brightness: 1   },
            { at: 300, hue: 270, saturate: 1.5, brightness: 1   },
            { at: 400, hue: 330, saturate: 1.8, brightness: 1   },
            { at: 500, hue: 180, saturate: 1.5, brightness: 1   },
            { at: 600, hue: 50,  saturate: 2,   brightness: 1.2 },
            { at: 700, hue: 0,   saturate: 3,   brightness: 0.5 },
            { at: 800, hue: 160, saturate: 2,   brightness: 1.3 },
            { at: 900, hue: 0,   saturate: 0,   brightness: 3   },
            { at: 1000, hue: 0,  saturate: 5,   brightness: 1   },
        ];

        const img = orange.querySelector('img');

        function updateColor() {
            let milestone = colorMilestones[0];
            for (const m of colorMilestones) {
                if (clickCount >= m.at) milestone = m;
            }
            img.style.filter = `hue-rotate(${milestone.hue}deg) saturate(${milestone.saturate}) brightness(${milestone.brightness})`;
        }

        function getLeaderboard() {
            return JSON.parse(localStorage.getItem('apelsin-leaderboard') || '[]');
        }

        function saveLeaderboard(board) {
            localStorage.setItem('apelsin-leaderboard', JSON.stringify(board));
        }

        function renderLeaderboard() {
            const board = getLeaderboard();
            leaderboardList.innerHTML = '';
            board.slice(0, 10).forEach((entry, i) => {
                const li = document.createElement('li');
                li.innerHTML = `<span><span class="rank">#${i + 1}</span> ${entry.name}</span><span class="score">${entry.score} klick</span>`;
                leaderboardList.appendChild(li);
            });
        }

        saveBtn.addEventListener('click', () => {
            const name = playerNameInput.value.trim() || 'Anonym';
            const board = getLeaderboard();
            board.push({ name, score: clickCount });
            board.sort((a, b) => b.score - a.score);
            saveLeaderboard(board.slice(0, 10));
            renderLeaderboard();
            saveBtn.disabled = true;
            saveBtn.textContent = 'Sparat!';
        });

        restartBtn.addEventListener('click', () => {
            saveBtn.disabled = false;
            saveBtn.textContent = 'Spara resultat';
            resetGame();
        });

        function handleClick(e) {
            e.preventDefault();
            if (gameOver) return;

            if (!gameStarted) {
                gameStarted = true;
                hintEl.textContent = 'Tryck så fort du kan på apelsinen!';
                startTimer();
            }

            clickCount++;
            clickCountEl.textContent = clickCount;
            angularVelocity += CLICK_BOOST;
            updateColor();

            if (clickCount % 100 === 0) {
                img.classList.add('pop');
                setTimeout(() => img.classList.remove('pop'), 500);
            }

            const rect = container.getBoundingClientRect();
            let x, y;

            if (e.touches) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }

            const ripple = document.createElement('div');
            ripple.className = 'click-effect';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            container.appendChild(ripple);
            setTimeout(() => ripple.remove(), 500);
        }

        container.addEventListener('click', handleClick);
        container.addEventListener('touchstart', handleClick, { passive: false });
        container.addEventListener('contextmenu', e => e.preventDefault());

        renderLeaderboard();
        requestAnimationFrame(update);
    </script>
</body>
</html>
